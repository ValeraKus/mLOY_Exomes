# mLOY_Exomes
The repository contains scripts to run the pipeline that estimates mosaic Loss of the Y chromosome from Exome sequencing data.
To run on dnanexus wdl script is available as well.
The release doi - DOI: 10.5281/zenodo.14205915 

# Requirements
1. mosdepth tool version 0.3.3 should be installed (https://github.com/brentp/mosdepth)
2. R
3. tidyverse library
4. If you want to perform the selection of exons from your exome capture you also need Biostrings and MatchIt R libraries. And hg38 human genome fasta file.

# Inputs
1. Bed file with intervals in a genome (exons) in which coverage will be calculated
2. Bed file with the same intervals but with the group for each interval in a separate column. Groups are created after matching exons on their GC content and are used for coverage normalization.
3. Bam/Cram Exome sequencing alignment file with index files.
4. Reference genome (the one used for the alignment).
5. GTF file with human genome annotation - https://ftp.ensembl.org/pub/current_gtf/homo_sapiens/Homo_sapiens.GRCh38.112.chr.gtf.gz


*If you have exome capture like in the UKB, or if you want to run MosCoverY in the UKB, you can skip step1 and step 2.*
*Steps 1 and 2 are needed to choose exons on chrY and autosomal exons for coverage normalization.*
*For the UKB these steps are done as described in the paper and the result is in resources/exome_capture_matched_intervals.bed*
*with the selected exons to use for the coverage calculation.*



# Pipeline
## All required scripts are in scripts/ folder

**1_choose_chrY_exons.R** - For choosing exons on the Y chromosome
**2_match_autosomal_exons.R** - For choosing autosomal exons for the coverage normalization by matching with chrY exons on GC content and length
**3_run_mosdepth.sh** - run mosdepth to calculate the coverage of all selected exons in steps 1 and 2. The prefix should be unique for each cram or bam file processed (e.g. individual id).
**4_NormalizeByGCcontentGroups.R** - normalize the coverage of chrY exons on their matched autosomal exons to get an individual-level estimate of. To run:

```
Rscript scripts/NormalizeByGCcontentGroups.R prefix.regions.bed.gz exome_groups.bed
```
prefix.regions.bed.gz file is generated by mosdepth on a previous step.
Scripts 3 and 4 are processing individual files, so to process multiple files you need to run them in a loop, or use parallelization.

**3_4_run_mosdepth_normalize.wdl** - Alternatively you can use wdl version of steps 3 and 4 to run it on the cloud like DNAnexus.

**5_aggregate_results.sh** - aggregate all the outputs into one file. You need to specify the name of the output file inside the script.

**6_mLOY_analysis.Rmd** - Finally, you can use Markdown file to set a binary threshold for loss of Y chromosome based on its normalized coverage and how to convert it to the fraction of cells with loss of chrY.


